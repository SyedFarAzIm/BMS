{% extends 'base.html' %}

{% block title %}{% if edit %}Edit Product{% else %}Add Product{% endif %} - Bakery Management System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">{% if edit %}Edit Product{% else %}Add New Product{% endif %}</h1>
    <a href="{{ url_for('product_list') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-1"></i>Back to Products
    </a>
</div>

<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-{% if edit %}edit{% else %}plus{% endif %} me-2"></i>
                    Product Details
                </h5>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data" id="productForm">
                    <div class="row">
                        <!-- Left Column -->
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="name" class="form-label">Product Name *</label>
                                        <input type="text" 
                                               class="form-control" 
                                               id="name" 
                                               name="name" 
                                               value="{% if edit %}{{ product.name }}{% endif %}"
                                               required 
                                               placeholder="Enter product name">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="quantity" class="form-label">Quantity/Description *</label>
                                        <input type="text" 
                                               class="form-control" 
                                               id="quantity" 
                                               name="quantity" 
                                               value="{% if edit %}{{ product.quantity }}{% endif %}"
                                               required 
                                               placeholder="e.g., 10 pieces, 2 kg">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="price" class="form-label">Price ($) *</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" 
                                                   class="form-control" 
                                                   id="price" 
                                                   name="price" 
                                                   value="{% if edit %}{{ product.price }}{% endif %}"
                                                   step="0.01" 
                                                   min="0" 
                                                   required 
                                                   placeholder="0.00">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <!-- NEW: Category Selection -->
                                    <div class="mb-3">
                                        <label for="category" class="form-label">Category *</label>
                                        <select class="form-select" id="category" name="category" required>
                                            <option value="">Select a category</option>
                                            <option value="Bread" {% if edit and product.category == 'Bread' %}selected{% endif %}>üçû Bread</option>
                                            <option value="Pastries" {% if edit and product.category == 'Pastries' %}selected{% endif %}>ü•ê Pastries</option>
                                            <option value="Cakes" {% if edit and product.category == 'Cakes' %}selected{% endif %}>üéÇ Cakes</option>
                                            <option value="Cookies" {% if edit and product.category == 'Cookies' %}selected{% endif %}>üç™ Cookies</option>
                                            <option value="Drinks" {% if edit and product.category == 'Drinks' %}selected{% endif %}>‚òï Drinks</option>
                                            <option value="Desserts" {% if edit and product.category == 'Desserts' %}selected{% endif %}>üç∞ Desserts</option>
                                            <option value="Sandwiches" {% if edit and product.category == 'Sandwiches' %}selected{% endif %}>ü•™ Sandwiches</option>
                                            <option value="Other" {% if edit and product.category == 'Other' %}selected{% endif %}>üì¶ Other</option>
                                            <option value="custom">‚úèÔ∏è Custom Category</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Custom Category Input -->
                            <div class="row" id="customCategoryRow" style="display: none;">
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label for="customCategory" class="form-label">Custom Category Name *</label>
                                        <input type="text" 
                                               class="form-control" 
                                               id="customCategory" 
                                               name="customCategory" 
                                               placeholder="Enter custom category name">
                                        <small class="form-text text-muted">Create your own category for this product</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column - Image Section -->
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="image" class="form-label">Product Image</label>
                                
                                <!-- Current Image Display (for edit mode) -->
                                {% if edit and product.image %}
                                <div class="mb-3">
                                    <label class="form-label">Current Image:</label>
                                    <div class="text-center">
                                        <img src="{{ url_for('static', filename='uploads/' + product.image) }}" 
                                             alt="{{ product.name }}" 
                                             class="img-thumbnail" 
                                             style="max-width: 100%; max-height: 200px;">
                                    </div>
                                    <small class="form-text text-muted">Upload a new image to replace the current one</small>
                                </div>
                                {% endif %}
                                
                                <!-- Image Upload -->
                                <input type="file" 
                                       class="form-control" 
                                       id="image" 
                                       name="image" 
                                       accept="image/*">
                                
                                <!-- Image Preview -->
                                <div id="imagePreview" class="mt-3 text-center" style="display: none;">
                                    <img id="previewImg" 
                                         class="img-thumbnail" 
                                         style="max-width: 100%; max-height: 200px;">
                                </div>
                                
                                <small class="form-text text-muted">
                                    Supported: JPG, PNG, GIF<br>
                                    Max size: 5MB
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Product Summary Panel -->
                    <div class="card mt-3">
                        <div class="card-body bg-light">
                            <h6 class="card-title">
                                <i class="fas fa-eye me-2"></i>Product Preview
                            </h6>
                            <div id="productSummary">
                                <p class="text-muted">Fill in the product details to see a preview</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <a href="{{ url_for('product_list') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-1"></i>Cancel
                        </a>
                        <div>
                            <button type="button" class="btn btn-outline-warning me-2" onclick="clearForm()">
                                <i class="fas fa-eraser me-1"></i>Clear Form
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-{% if edit %}save{% else %}plus{% endif %} me-1"></i>
                                {% if edit %}Update Product{% else %}Save Product{% endif %}
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}